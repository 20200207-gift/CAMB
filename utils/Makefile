#

libutils: directories

ifortErr = $(shell which ifort >/dev/null 2>&1; echo $$?)
ifeq "$(ifortErr)" "0"

#Intel compiler
#F90C     ?= ifort
#F90FLAGS ?=  -O2 -W0 -WB -fpp2 -vec_report0

else
F90C ?= gfortran
F90FLAGS ?= -ffree-line-length-none -fmax-errors=4
# Always need preprocessing so ensure it is there.
F90FLAGS += -cpp
endif
AR ?= ar

ifeq ($(F90DEPFLAGS),)
$(warning *************** WARNING ********************** \
libutils.a: Please specify how the compiler generates source file dependencies\
by putting the necessary flags into the F90DEPFLAGS variable. Without it\
partial rebuils are not possible.\
********************************************")
endif

SRCS = MiscUtils.f90 StringUtils.f90 ArrayUtils.f90 MpiUtils.f90 FileUtils.f90 \
	   IniObjects.f90 RandUtils.f90 ObjectLists.f90 MatrixUtils.f90 RangeUtils.f90
OBJS = $(patsubst %.f90,%.o,$(SRCS))

%.o: $(SRC_DIR)/%.f90
	$(F90C) $(F90FLAGS) $(F90DEPFLAGS) -o $*.o -c $<

libutils.a: $(OBJS)
	$(AR) -r libutils.a $(OBJS)

clean:
	-rm -fr Debug Release

# export all variables to the sub-make below
export

# Build in output dir to get file dependencies correctly and make use
# of delta builds, where only changed files and their dependents are
# rebuild.
directories:
	mkdir -p $(OUTPUT_DIR)
	$(MAKE) -C $(OUTPUT_DIR) -f../Makefile SRC_DIR=.. libutils.a

# Include dependency files generated by a previous run of make
-include $(SRCS:.f90=.d)

.PHONY: directories clean Release Debug libutils.a

